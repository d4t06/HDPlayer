import{collection as t,getDocs as n,query as s,where as e}from"https://www.gstatic.com/firebasejs/10.4.0/firebase-firestore.js";import{songListSelect as o,songlist as i,timeSliderCurrent as r,timeSliderHolder as a,currentTimeEle as l,durationEle as c,volumeSliderCurrent as h,switchBtn as d,randomBtn as g,rePeatBtn as u,player as m}from"./constant.js";import{db as p}from"./firebase/config.js";import{onPauseHandle as f}from"./handleEvent.js";import{getLocalStorageItem as x}from"./utils/appHelper.js";const v=document.querySelector.bind(document),y=document.querySelectorAll.bind(document);let S=[];export const getActuallySongs=function(){console.log("get actually songs"),S="playlist"===this.song_in?this.playlistSongs:this.songs};export const fetchSongs=async function(){const o=t(p,"songs"),i=s(o,e("by","==","huudat01234560@gmail.com")),r=t(p,"playlist"),a=s(r,e("by","==","huudat01234560@gmail.com"));try{const t=await n(i),s=await n(a);if(t.docs.length){const n=t.docs.map((t=>t.data()));this.songs=n}else this.songs=temporarySongs;if(s.docs.length){const t=s.docs.map((t=>t.data()));this.playlists=t}}catch(t){console.log(t)}};export const sortSongs=function(){var t=this.songs.sort(((t,n)=>t.name>n.name));this.songs=t};export const render=function(){let t="";if(!S.length)return t+="<h1>Error when render songs</h1>";S.forEach(((n,s)=>{t+=`<li class="song-item" id="${s}">\n            <div class="song-frame">\n              <div class="song-img" style="background-image: url(${n.image_url||"https://placehold.co/100"})" >\n              </div>\n            </div>\n            <div class="song-info">\n              <h2>${n.name}</h2>\n              <h4>${n.singer}</h4>\n            </div>\n            <div class="song-detail">\n              <i class="fa-solid fa-ellipsis-vertical"></i>\n            </div>\n          </li>`})),i.innerHTML=t};export const renderMenu=function(){let t='<option value="">Default</option>';this?.playlists?.length&&(this.playlists.forEach((n=>t+=`<option value='${n.name}'>${n.name}</option>`)),o.innerHTML=t)};export const nextSong=function(){let t=this.currentIndex+1;t<=S.length-1?this.currentIndex=t:(this.currentIndex=0,this.endOfList=!0),this.loadCurrentSong()};export const prevSong=function(){this.currentIndex=this.currentIndex>0?this.currentIndex-1:S.length-1,this.loadCurrentSong()};export const randomSong=function(){let t=0;do{t=Math.floor(S.length*Math.random())}while(t===this.currentIndex);this.currentIndex=t,this.loadCurrentSong()};export const loadCurrentSong=function(){f(this),r.style.width="0%",a.style.transform="translateX(100%, -50%)",l.innerText="00:00",c.innerText="/ --:--",console.log("run this");let t=v(".dashboard h4"),n=v(".dashboard h2"),s=v(".cd-img"),e=v(".audio"),o=v(".title-wrapper h2"),i=y(".song-item");"unset"!==n.style.transition&&(console.log("unScroll text"),o.style.transition="unset",o.style.transform="translateX(0px)");const h=S[this.currentIndex],d=i[this.currentIndex];for(var g of i)g.classList.contains("active")&&g.classList.remove("active");d.classList.add("active"),t.innerText=h.singer,n.innerText=h.name,s.style.backgroundImage=`url(${h.image_url||"https://placehold.co/300"})`,e.src=h.song_url,document.title=h.name};export const loadConfig=function(){if(this.isRepeat=x("isRepeat"),this.isDark=x("isDark"),window.innerWidth>550){let t=x("volume");h.style.width=100*t+"%",this.volume=t}g.classList.toggle("active",!!this.isRandom),u.classList.toggle("active",!!this.isRepeat),m.classList.toggle("dark",!!this.isDark),d.classList.toggle("dark",!!this.isDark)};