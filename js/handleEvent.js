import{handleTimeText as t,setLocalStorage as n}from"./utils/appHelper.js";import{dashboard as e,cd as i,cdImg as o,playBtn as s,prevBtn as l,nextBtn as a,randomBtn as c,rePeatBtn as r,musicVolume as d,gotopBtn as u,timeSlider as f,timeSliderCurrent as p,timeSliderHolder as m,volumeSliderCurrent as g,currentTimeEle as y,durationEle as h}from"./constant.js";const w=document.querySelector.bind(document),x=document.querySelectorAll.bind(document);let v;const L=function(t){s.classList.remove("playing"),t.isPlaying=!1,o.style.animationPlayState="paused"};export{L as onPauseHandle};export default function(){const k=this,T=w(".audio"),W=x(".song-item"),P=i.offsetWidth,R=window.innerWidth>=724;let S=!0,b=!1;T.volume=this.volume;const F=function(){T.play(),k.isPlaying=!0,s.classList.add("playing")},I=function(t){setTimeout((()=>{t.scrollIntoView({behavior:"smooth",block:"center"})}),200)},H=t=>{const n=w(".song-item.active");if(!n)return;if(void 0!==t)return I(W[t]);const i=n.getBoundingClientRect(),o=e.offsetHeight,s=R?i.top>0:i.top>o,l=i.top<window.innerHeight;s&&l&&I(n)};o.onclick=()=>{H(k.currentIndex)};const X=()=>{v&&clearInterval(v);let t,n,e=w(".title-wrapper h2"),i=w(".title-wrapper");if(!e||!i)return;const o=()=>{e.style.transition=`transform linear ${t}s`,e.style.transform=`translateX(-${n}px)`,setTimeout((()=>{(()=>{let t=w(".title-wrapper h2");console.log("unscroll text"),t.style.transition="unset",t.style.transform="translateX(0px)"})()}),1e3*t)};e.offsetWidth-i.offsetWidth>0&&(n=e.offsetWidth+20,t=+(n/35).toFixed(1),e.innerHTML=e.innerText+"&nbsp; &nbsp; &nbsp;"+e.innerText,o(),v=setInterval((()=>{o()}),1e3*t+3e3+1e3))};W.forEach((t=>{t.onclick=n=>{n.target.parentElement.classList.contains("song-detail")||+t.id!==k.currentIndex&&(k.currentIndex=+t.id,k.loadCurrentSong())}})),window.onscroll=function(){if(R)return;const t=window.scrollY||document.documentElement.scrollTop,n=P-t/2,e=n/P;if(n<0)return i.style.width="0px",i.style.opacity=0,void u.classList.add("show");i.style.width=n+"px",i.style.opacity=e,u.classList.remove("show")};function E(t){g.style.width=100*t+"%",T.volume=t,n("volume",t)}T.onplaying=()=>(s.classList.add("playing"),s.classList.remove("waiting"),k.isPlaying=!0,k.isWaiting=!1,void(o.style.animationPlayState="running")),T.onpause=()=>{L(k)},T.ontimeupdate=function(){const n=T.currentTime,e=T.duration;n&&(p.style.width=(n/(e/100)).toFixed(1)+"%",m.style.transform=`translate(${100-+(n/(e/100)+1).toFixed(1)+"%"}, -50%)`,y.innerText=t(n)||"00:00")},T.onended=function(){k.isRepeat?F():k.isRandom?k.randomSong():k.nextSong()},T.onloadedmetadata=n=>{h.innerText="/ "+t(n.target.duration),b=!0,S?S=!1:k.endOfList?k.endOfList=!1:k.isPlaying||(H(),X(),F())},T.onwaiting=()=>(k.isWaiting=!0,s.classList.add("waiting"),void s.classList.remove("playing")),d.onclick=function(t){let n=d.offsetWidth;E(+((t.clientX-25)/n).toFixed(2))},d.onwheel=function(t){t.preventDefault();const n=.05;let e=T.volume;t.deltaY>0?e-n>0?e-=n:e=0:e+n<1?e+=n:e=1,E(+e.toFixed(2))},f.onclick=t=>{if(!b)return;let n=f.offsetWidth,e=Math.floor((t.clientX-25)/n*100),i=T.duration*e/100;T.currentTime=+i.toFixed(2),k.isPlaying||this.isWaiting||F()},s.onclick=function(){b&&(console.log("click",k.isPlaying),k.isPlaying?T.pause():T.play())},a.onclick=function(){k.nextSong(),k.endOfList=!1},l.onclick=function(){k.prevSong()},c.onclick=function(){const t=!k.isRandom;k.isRandom=t,n("isRandom",t),c.classList.toggle("active",t)},r.onclick=function(){const t=!k.isRepeat;k.isRepeat=t,n("isRepeat",t),r.classList.toggle("active",t)},u.onclick=()=>H(0)}