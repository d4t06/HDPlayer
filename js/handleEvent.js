import{handleTimeText as t,setLocalStorage as n}from"./utils/appHelper.js";import{dashboard as e,cd as i,cdImg as o,playBtn as s,prevBtn as l,nextBtn as a,randomBtn as c,rePeatBtn as r,musicVolume as d,gotopBtn as u,timeSlider as f,timeSliderCurrent as p,timeSliderHolder as g,volumeSliderCurrent as m,currentTimeEle as y,durationEle as h}from"./constant.js";const x=document.querySelector.bind(document),v=document.querySelectorAll.bind(document);let w;const L=function(t){s.classList.remove("playing"),t.isPlaying=!1,o.style.animationPlayState="paused"};export{L as onPauseHandle};export default function(){const k=this,R=x(".audio"),T=v(".song-item"),W=i.offsetWidth,P=window.innerWidth>=724;let S=!0,b=!1;R.volume=this.volume;const F=function(){R.play(),k.isPlaying=!0,s.classList.add("playing")},I=function(t){setTimeout((()=>{t.scrollIntoView({behavior:"smooth",block:"center"})}),200)},H=t=>{const n=x(".song-item.active");if(!n)return;if(void 0!==t)return I(T[t]);const i=n.getBoundingClientRect(),o=e.offsetHeight,s=P?i.top>0:i.top>o,l=i.top<window.innerHeight;s&&l?(console.log("scroll"),I(n)):console.log("no scroll")};o.onclick=()=>{H(k.currentIndex)};const X=()=>{w&&clearInterval(w);let t,n,e=x(".title-wrapper h2"),i=x(".title-wrapper");if(!e||!i)return;const o=()=>{console.log("scroll text"),e.style.transition=`transform linear ${t}s`,e.style.transform=`translateX(-${n}px)`,setTimeout((()=>{(()=>{let t=x(".title-wrapper h2");console.log("unscroll text"),t.style.transition="unset",t.style.transform="translateX(0px)"})()}),1e3*t)};e.offsetWidth-i.offsetWidth>0&&(n=e.offsetWidth+20,t=+(n/35).toFixed(1),e.innerHTML=e.innerText+"&nbsp; &nbsp; &nbsp;"+e.innerText,o(),w=setInterval((()=>{o()}),1e3*t+3e3+1e3))};T.forEach((t=>{t.onclick=n=>{n.target.parentElement.classList.contains("song-detail")||+t.id!==k.currentIndex&&(k.currentIndex=+t.id,k.loadCurrentSong())}})),window.onscroll=function(){if(P)return;const t=window.scrollY||document.documentElement.scrollTop,n=W-t/2,e=n/W;if(n<0)return i.style.width="0px",i.style.opacity=0,void u.classList.add("show");i.style.width=n+"px",i.style.opacity=e,u.classList.remove("show")};function E(t){m.style.width=100*t+"%",R.volume=t,n("volume",t)}R.onplaying=()=>(s.classList.add("playing"),s.classList.remove("waiting"),k.isPlaying=!0,k.isWaiting=!1,void(o.style.animationPlayState="running")),R.onpause=()=>{L(k)},R.ontimeupdate=function(){const n=R.currentTime,e=R.duration;n&&(p.style.width=(n/(e/100)).toFixed(1)+"%",g.style.transform=`translate(${100-+(n/(e/100)+1).toFixed(1)+"%"}, -50%)`,y.innerText=t(n)||"00:00")},R.onended=function(){if(k.isRepeat)return F(),void console.log("Repeat");k.isRandom?k.randomSong():k.nextSong()},R.onloadedmetadata=n=>{h.innerText="/ "+t(n.target.duration),b=!0,S?S=!1:k.endOfList?k.endOfList=!1:k.isPlaying||(H(),X(),F())},R.onwaiting=()=>(k.isWaiting=!0,s.classList.add("waiting"),void s.classList.remove("playing")),d.onclick=function(t){let n=d.offsetWidth;E(+((t.clientX-25)/n).toFixed(2))},d.onwheel=function(t){t.preventDefault();const n=.05;let e=R.volume;t.deltaY>0?e-n>0?e-=n:e=0:e+n<1?e+=n:e=1,E(+e.toFixed(2))},f.onclick=t=>{if(!b)return;let n=f.offsetWidth,e=Math.floor((t.clientX-25)/n*100),i=R.duration*e/100;R.currentTime=+i.toFixed(2),k.isPlaying||this.isWaiting||F()},s.onclick=function(){b&&(console.log("click",k.isPlaying),k.isPlaying?R.pause():R.play())},a.onclick=function(){k.nextSong(),k.endOfList=!1},l.onclick=function(){k.prevSong()},c.onclick=function(){const t=!k.isRandom;k.isRandom=t,n("isRandom",t),c.classList.toggle("active",t)},r.onclick=function(){const t=!k.isRepeat;k.isRepeat=t,n("isRepeat",t),r.classList.toggle("active",t)},u.onclick=()=>H(0)}