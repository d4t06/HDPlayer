import{audio,goTopBtn,musicVolume,nextBtn,playBtn,prevBtn,randomBtn,rePeatBtn,timeSlider}from"./constant.js";import{updateVolume}from"./handleAudioEvent.js";import{getLocalStorageItem,setLocalStorage}from"./utils/appHelper.js";const $$=document.querySelectorAll.bind(document);export default function handleEvent(){const o=this,t=$$(".song-item");t.forEach(((e,n)=>{e.onclick=i=>{o.currentIndex&&t[o.currentIndex].contains(i.target)||o.currentSong&&e.id===o.currentSong.id||(o.currentIndex=n,o.isFirstLoadSong=!1,o.loadCurrentSong())}})),window.onscroll=function(){(window.scrollY||document.documentElement.scrollTop)>100?goTopBtn.classList.add("show"):goTopBtn.classList.remove("show")},musicVolume.onclick=function(o){let t=musicVolume.offsetWidth,e=(o.clientX-25)/t;updateVolume(+e.toFixed(2)),setLocalStorage("volume",e.toFixed(2))},musicVolume.onwheel=function(o){o.preventDefault();const t=.05;let e=audio.volume;o.deltaY>0?e-t>0?e-=t:e=0:e+t<1?e+=t:e=1,updateVolume(+e.toFixed(2)),setLocalStorage("volume",e.toFixed(2))},timeSlider.onclick=o=>{let t=timeSlider.offsetWidth,e=Math.floor((o.clientX-25)/t*100),n=audio.duration*e/100;audio.currentTime=+n.toFixed(2)},playBtn.onclick=function(){if(o.isPlaying)audio.pause();else{if(o.isFirstLoadSong){const t=getLocalStorageItem("current-time",0);audio.currentTime=t,o.isFirstLoadSong=!1}audio.play()}},nextBtn.onclick=function(){o.nextSong(),o.endOfList=!1},prevBtn.onclick=function(){o.prevSong()},randomBtn.onclick=function(){const t=!o.isRandom;o.isRandom=t,setLocalStorage("isRandom",t),randomBtn.classList.toggle("active",t)},rePeatBtn.onclick=function(){const t=!o.isRepeat;o.isRepeat=t,setLocalStorage("isRepeat",t),rePeatBtn.classList.toggle("active",t)},goTopBtn.onclick=()=>{document.body.scrollTop=0,document.documentElement.scrollTop=0}}